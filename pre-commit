#!/usr/bin/env bash

# COPY ME INTO the .git/hooks directory

#
# Find binaries generated by Automake by searching src/Makefile.am
# and add them to .gitignore
#


# Find programs in src/Automake.am
programs=$( \
          cat src/Makefile.am | \
          grep PROGRAMS | \
          sed 's/.*= //g' | \
          sed 's/ /\n/g' |\
          sed 's/^/src\//g'
         )

# Add comment to .gitignore
programs="# Compiled binaries
$programs"


# Load old .gitignore file
gitignore=$( cat .gitignore )

# Strip programs from gitignore
for program in $programs; do
  gitignore=$( echo "$gitignore" | grep -v $program )
done

# Add all programs to gitignore
echo "$gitignore" >  .gitignore
echo              >> .gitignore
echo "$programs"  >> .gitignore
